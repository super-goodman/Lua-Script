
pickUpState = 0
function mail()
    for i=1,4,1 do --循环将所有副背包的物品都放入,直到填满邮件
        bagNum = getBagSlotNum(i) --获得背包的大小
        unUsedSLot = getUnusedBagSlotNum(i)--获得背包剩余的空格子
        if bagNum-unUsedSLot > 0 then --如果背包中有东西
            contactClosetMailObjec()--与邮箱互动(打开邮箱)
            clickSendMailFrame()--打开发送页面
            setMailTargetName()--填写名字，名字在脚本界面填写
            for k = 1,bagNum,1 do --尝试将背包中的每个格子都放入邮箱，没有就不放，有就会放进去
                putMailItem(i,k) --放入
            end
            sendMail()--发送邮件
            sleep(500) -- 略微延迟，防止发邮件卡住
        end
        if i == 3 then
            contactClosetMailObjec()--与邮箱互动
            clickSendMailFrame()--打开发送页面
            putMailMoney(3)--放入1G
            setMailTargetName1()--填写名字，名字在脚本界面填写
            sendMail()--发送邮件
            useLua("/click MailFrameCloseButton")
        end
    end
end


function pickUp() --拾取
    if pickUpState == 0 then
        return 0
    end
    while true do -- 循环n次（mld可能有很多怪）
        if getRoleCurrentHP() == -1 then --如果结束脚本就退出
            break
        end
        local n = getUnusedAllBagSlotNum()--获得背包剩余的格子数目
        if(n > 4) then --如果背包大于4格子就拾取
            local ID1,ID2 = getClosetTargetIDFilterCanBeLoot() --获得最近的可以被拾取的鬼屋
            if ID1 ~= 0 and ID1 ~= -1 then --证明搜索到了怪物
                local distance = getTargetAndRoleDistanceByID(ID1,ID2,3) --获得目标与玩家的距离
                if distance < 15 and distance >= 0 then -- 如果在8码范围内，防止去拾取太远的目标，然后被卡住
                    contactTarget(ID1,ID2) --拾取目标
                    useLua("/click Destroyer") --销毁垃圾
                    --useLua("/click AceGUI30Button11") --销毁垃圾
                    sleep(100)
                    useLua("/click StaticPopup1Button1") --拾取蓝装
                else --范围外就跳出循环
                    break
                end
            else --代表没有可以拾取的目标了，跳出循环
                break
            end
        else
            break
        end
    end
   
    
end

function drink()
    local drinkBag, drinkSlot = getBelongBagAndSlotByID(30703)
    local breadBag, breadSlot = getBelongBagAndSlotByID(22895)
    if drinkSlot == 0 or breadSlot == 0 then
        standBy()
        castSpellA("造食术(等级 7)")
        sleep(3500)
        castSpellA("造水术(等级 8)")
        sleep(3500)
    end
    local je1Bag, je1Slot = getBelongBagAndSlotByID(22044)
    if je1Slot == 0 then
        standBy()
        castSpellA("制造魔法玉石")
        sleep(3500)
    end
    if getRoleCurrentHP() < 95 and getRoleCurrentMP() < 95 and getRoleCurrentHP() >= 0 and getRoleCurrentMP() >= 0 then
        useItem("魔法肉桂面包")
        useItem("魔法山泉水")
    end
    while true do
        if getRoleCurrentHP() == -1 then
            break
        end
        if IsBuffExist(29073) == 0 or IsBuffExist(34291) == 0 then
            useItem("魔法肉桂面包")
            useItem("魔法山泉水")
        end
        if getRoleCurrentHP() >= 95 and getRoleCurrentMP() >= 95 then
            break
        end
        if getRoleflag1() == 0x08 then
            local ID1,ID2 = getClosetTargetIDInBattle(3)
            while ID1 ~= 0 and ID1 ~= -1 do
                ID1,ID2 = getClosetTargetIDInBattle(3)
                local distance = getTargetAndRoleDistanceByID(ID1,ID2,3)
                if distance <= 10 and distance > 0 then
                    castSpellB("魔爆术(等级 8)")
                end
            end
            useItem("魔法肉桂面包")
            useItem("魔法山泉水")
        end
        sleep(1000)
    end
    
end

function openGate()
    local ID1,ID2 = getClosetTargetIDToAPositionFilterName("杠杆",-254.655, 2116.86,6,4)
    contactTarget(ID1,ID2)
end

function talkWithNpc()
    local ID1,ID2 = getClosetTargetIDToAPositionFilterName( "亡灵哨兵阿达曼特",-245.412, 2114.54, 3, 8)
    contactTarget(ID1,ID2)
    sleep(1000)
    useLua("/click GossipTitleButton1")
end

function battle()
    local name,chat = getChatInfoByType(7)
    if name ~= "" and name ~= 0 and name ~= -1 then
        --useLua("/reply 没有")
    end
    local ID1,ID2 = getClosetTargetIDInBattle(3)
    while ID1 ~= 0 and ID1 ~= -1 do
        ID1,ID2 = getClosetTargetIDInBattle(3)
        local distance = getTargetAndRoleDistanceByID(ID1,ID2,3)
        if distance <= 10 and distance >= 0 then
            castSpellB("魔爆术(等级 8)")
        end
    end
end

--主程序开始
useLua("/removefriend 炒鸡感激")
sleep(2000)
useLua("/friend 炒鸡感激")
if IsBuffExist(8326) == 0 then -- 如果身上没有带着灵魂状态的Debuff

    x,y,z = getRolePosition()
    mapDistance1 = getDistanceBetween(x,y,507.828,1633.19)--如果在炉石
    if mapDistance1 <= 40 and mapDistance1 >= 0 then
        moveA(507.828,1633.19,125.944)
        moveA(507.777,1627.18,125.668)
        mail()
        moveA(508.91,1607.54,125.284)
        moveA(511.54,1601.04,126.188)
        moveA(532.874,1595.78,127.735)
        moveA(543.413,1590.69,129.358)
        moveA(562.871,1559.44,132.722)
        ID1,ID2 = getClosetTargetIDFilterName("纳迪亚・沃农",3,8)
        contactTarget(ID1,ID2)
        sleep(1000) --等待打开修理界面
        useLua("/run RepairAllItems()")
        sleep(3000)
        useLua("/click MerchantFrameCloseButton")
        useItem("霜狼嗥叫者的号角")
        useItem("紫色陆行鸟")
        sleep(3500)
        moveA(524.207,1550.02,132.172)
        moveA(474.661,1531.74,131.921)
        moveA(416.947,1501.79,131.991)
        moveA(331.566,1444.23,126.09)
        moveA(278.672,1415.49,114.477)
        moveA(229.956,1407.6,108.425)
        moveA(212.282,1401.68,104.886)
        moveA(176.519,1382.34,97.6568)
        moveA(141.872,1362.77,93.2817)
        moveA(113.272,1360.48,97.7161)
        moveA(79.3817,1350.09,71.8917)
        moveA(69.9436,1344.97,68.655)
        moveA(40.5155,1344.08,63.4836)
        moveA(0.419997,1333.94,60.4051)
        moveA(-56.8804,1334.13,62.7332)
        moveA(-119.799,1315.45,55.6782)
        moveA(-154.218,1317.86,46.9533)
        moveA(-229.538,1379.33,35.5958)
        moveA(-273.986,1424.16,33.7821)
        moveA(-294.179,1462.44,36.2028)
        moveA(-278.519,1472.19,41.5892)
        useLua("/party follow2") --让小号出本
        moveA(-221.436,1455.96,61.3558)
        moveA(-200.925,1476.48,66.4843)
        moveA(-220.971,1505.42,72.6117)
        moveA(-247.69,1527.49,77.1437)
        moveA(-237.188,1556.68,76.8923)

    end

    moveA(-235.061,1562.24,76.8921)
    moveA(-233.711,1564.56,76.8921)
    moveB(-231.412,1570.74,76.8921)
    waitForLoading()
    --上面是进本，要等待读条10s

    moveA(-228.191,2111.41,76.8904) -- 准备工作
    drink()
    sleep(1000)
    castSpellA("奥术智慧(等级 6)")
    castSpellA("冰甲术(等级 5)")
    castSpellA("寒冰护体(等级 6)")
    drink()
    useLua("/party follow1") --让小号进本
    moveA(-217.433,2107.59,76.889)
    castSpellB("魔爆术(等级 1)")
    moveA(-209.57,2102.66,76.8926)
    castSpellB("魔爆术(等级 1)")
    moveA(-208.753,2101.91,76.8926)
    castSpellB("魔爆术(等级 1)")
    moveA(-202.329,2099.1,76.8926)
    castSpellB("魔爆术(等级 1)")
    moveA(-202.329,2099.1,76.8926)
    castSpellB("魔爆术(等级 1)")
    moveA(-202.054,2099.41,76.8926)
    castSpellB("魔爆术(等级 1)")
    moveA(-200.092,2105.84,78.557)
    castSpellB("魔爆术(等级 1)")
    moveA(-200.725,2106.63,78.557)
    castSpellB("魔爆术(等级 1)")
    moveA(-205.729,2108.96,80.8831)
    castSpellB("魔爆术(等级 1)")
    moveA(-207.179,2113.03,81.0554)
    castSpellB("魔爆术(等级 1)")
    moveA(-206.286,2114.1,81.0554)
    castSpellB("魔爆术(等级 1)")
    moveA(-205.553,2114.97,81.0554)
    castSpellB("魔爆术(等级 1)")
    moveA(-198.58,2123.57,81.5019)
    castSpellB("魔爆术(等级 1)")
    moveA(-192.496,2132.81,81.5019)
    castSpellB("魔爆术(等级 1)")
    moveA(-189.368,2140.94,83.1681)
    castSpellB("魔爆术(等级 1)")
    moveA(-189.438,2141.16,83.1681)
    castSpellB("魔爆术(等级 1)")
    moveA(-194.002,2143.03,85.429)
    castSpellB("魔爆术(等级 1)")
    moveA(-195.43,2143.48,86.268)
    castSpellB("魔爆术(等级 1)")
    moveA(-201.723,2145.26,87.7631)
    castSpellB("魔爆术(等级 1)")
    moveA(-202.702,2145.49,88.2715)
    castSpellB("魔爆术(等级 1)")
    moveA(-206.961,2143.88,90.453)
    castSpellB("魔爆术(等级 1)")
    moveA(-207.553,2143.39,90.6277)
    castSpellB("魔爆术(等级 1)")
    moveA(-218.112,2143.68,90.6247)
    castSpellB("魔爆术(等级 1)")
    moveA(-230.342,2148,90.6247)
    castSpellB("魔爆术(等级 1)")
    moveA(-236.604,2142.98,87.5046)
    castSpellB("魔爆术(等级 1)")
    moveA(-236.145,2132.27,87.0135)
    castSpellB("魔爆术(等级 1)")
    moveA(-237.556,2120.93,87.0048)
    castSpellB("魔爆术(等级 1)")
    moveA(-239.562,2115.8,87.0035)
    castSpellB("魔爆术(等级 1)")
    moveA(-246.585,2119.39,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-246.583,2119.41,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-243.941,2128.06,87.0115)
    castSpellB("寒冰护体(等级 6)")
    moveA(-243.796,2128.41,87.0115)
    moveA(-243.312,2129.57,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-243.211,2129.82,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-242.516,2134.75,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-242.47,2134.89,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-239.967,2141.06,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-239.967,2141.06,87.0115)
    castSpellB("魔爆术(等级 1)")
    moveA(-248.57,2144.31,87.0116)
    castSpellB("魔爆术(等级 1)")
    moveA(-250.983,2141.3,86.303)
    castSpellB("魔爆术(等级 1)")
    moveA(-254.395,2128.41,81.1797)
    castSpellB("魔爆术(等级 1)")
    moveA(-254.558,2117.17,81.1797)
    sleep(1000) --等待
    openGate()
    sleep(1400) --等待门开
    moveA(-246.501,2114.16,81.1797)
    castSpellB("魔爆术(等级 1)")
    moveA(-244.225,2113.43,81.1797)
    talkWithNpc()   
    sleep(1000) --等待对话框出现     
    moveA(-244.225,2113.43,81.1797)
    battle() 
    pickUp()
    sleep(100)   --莫名其妙的延迟，原版有就加上去了      
    --救完NPC 

    moveA(-245.099,2113.75,81.1796)
    moveA(-250.049,2115.77,81.1796)
    moveA(-255.434,2118.3,81.1796)
    moveA(-254.984,2127.57,81.1796)
    moveA(-249.652,2143.92,87.0129)
    moveA(-249.479,2144.7,87.0129)
    moveA(-239.08,2140.83,87.0129)
    moveA(-235.788,2150.86,90.6243)
    moveA(-241.622,2156.12,90.6243)
        
    drink()
    prints("休息3分钟")
    sleep(180000)

    -- 准备出门
    moveA(-242.104,2155.32,90.6243)
    sleep(100)
    castSpellB("寒冰护体(等级 6)")
    moveA(-241.874,2156.05,90.6243)
    sleep(100)
    castSpellB("寒冰护体(等级 6)")
    moveA(-235.495,2170.19,86.3892)
    castSpellB("魔爆术(等级 1)")
    moveA(-226.151,2163.29,79.7654)
    castSpellB("魔爆术(等级 1)")
    moveA(-217.385,2159.37,79.764)
    castSpellB("魔爆术(等级 1)")
    moveA(-208.373,2170.75,79.7647)
    castSpellB("魔爆术(等级 1)")
    moveA(-200.756,2165.42,79.7514)
    castSpellB("魔爆术(等级 1)")
    moveA(-198.97,2165.28,79.746)
    castSpellB("魔爆术(等级 1)")
    moveA(-207.316,2194.84,79.7646)
    castSpellB("魔爆术(等级 1)")
    moveA(-216.101,2207.84,79.7646)
    castSpellB("魔爆术(等级 1)")
    moveA(-214.74,2218.09,79.7631)
    castSpellB("魔爆术(等级 1)")
    moveA(-192.762,2213.46,79.7617)
    castSpellB("魔爆术(等级 1)")
    moveA(-175.794,2218.69,79.7531)
    castSpellB("魔爆术(等级 1)")
    moveA(-178.527,2226.26,78.0193)
    castSpellB("魔爆术(等级 1)")
    moveA(-180.996,2234.82,76.2413)
    castSpellB("寒冰护体(等级 6)")
    moveA(-182.345,2245.81,76.2024)
    castSpellB("魔爆术(等级 1)")
    moveA(-197.307,2255.56,76.2024)
    castSpellB("魔爆术(等级 1)")
    moveA(-216.896,2265.72,75.6065)
    castSpellB("魔爆术(等级 1)")
    moveA(-232.204,2273.07,74.9994)
    castSpellB("魔爆术(等级 1)")
    moveA(-247.372,2280.74,74.9994)
    castSpellB("魔爆术(等级 1)")
    moveA(-264.608,2290.25,75.3269)
    castSpellB("魔爆术(等级 1)")
    moveA(-269.969,2289.95,76.1534)--拉boss
    castSpellB("魔爆术(等级 1)")
    moveA(-273.444,2292.75,76.1535)
    castSpellB("魔爆术(等级 1)")
    moveA(-271.364,2299.31,76.1535)
    castSpellB("魔爆术(等级 1)")
    moveA(-258.388,2297.49,74.9998)
    castSpellB("魔爆术(等级 1)")
    moveA(-269.218,2305.11,80.7526)
    castSpellB("寒冰护体(等级 6)")
    moveA(-280.649,2307.23,85.8546)
    castSpellB("魔爆术(等级 1)")
    moveA(-283.037,2305.83,87.8572)
    castSpellB("魔爆术(等级 1)")
    moveA(-284.507,2306.49,88.6796)
    castSpellB("魔爆术(等级 1)")
    moveA(-292.014,2303.82,90.6085)
    castSpellB("魔爆术(等级 1)")
    moveA(-291.678,2315.04,92.6028)
    castSpellB("魔爆术(等级 1)")
    moveA(-281.574,2326.81,95.8665)
    castSpellB("魔爆术(等级 1)")
    moveA(-268.205,2320.46,95.8665)
    castSpellB("魔爆术(等级 1)")
    moveA(-254.837,2314.6,95.8665)
    castSpellB("魔爆术(等级 1)")
    moveA(-241.737,2309.35,95.8665)
    castSpellB("魔爆术(等级 1)")
    moveA(-225.244,2303.83,94.6767)
    castSpellB("魔爆术(等级 1)")
    moveA(-213.596,2298.77,95.8788)
    castSpellB("魔爆术(等级 1)")
    moveA(-199.046,2292.76,95.899)
    castSpellB("魔爆术(等级 1)")
    moveA(-187.973,2286.75,95.899)
    castSpellB("魔爆术(等级 1)")
    moveA(-189.333,2277.15,93.6032)
    castSpellB("寒冰护体(等级 6)")
    moveA(-189.43,2276.8,93.4485)
    castSpellB("寒冰护体(等级 6)")
    moveA(-193.11,2264.19,90.6439)
    castSpellB("魔爆术(等级 1)")
    moveA(-182.797,2259.19,89.2563)
    castSpellB("魔爆术(等级 1)")
    moveA(-170.374,2250.67,86.3731)
    castSpellB("魔爆术(等级 1)")
    moveA(-162.468,2242.54,86.1512)
    castSpellB("魔爆术(等级 1)")
    moveA(-158.023,2228.27,82.8293)
    castSpellB("魔爆术(等级 1)")
    moveA(-168.573,2219.04,80.8042)
    castSpellB("魔爆术(等级 1)")
    moveA(-181.581,2214.47,79.7358)
    castSpellB("魔爆术(等级 1)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    castSpellB("魔爆术(等级 8)")
    moveA(-185.149,2217,79.7489)
    sleep(800)
    castSpellB("寒冰护体(等级 6)")
    moveA(-185.149,2217,79.7489)
    battle()
    sleep(2000)
    pickUp()
    moveA(-185.149,2217,79.7489)
    castSpellB("解除次级诅咒")
    sleep(1400)
    drink()
    if pickUpState == 0 then
        prints("休息2分钟")
        sleep(120000)
    else
        prints("休息1分钟")
        sleep(60000)
    end
    --准备拉到楼上
    moveA( -184.774,2216.74,79.7453)
    moveA( -176.159,2219.09,79.7528)
    moveA( -180.063,2229.89,76.2402)
    moveA( -182.985,2247.25,76.2014)
    moveA( -214.136,2264.51,76.2014)
    moveA( -229.08,2270.86,74.9994)
    moveA( -241.051,2276.38,74.9994)
    castSpellB("闪现术")
    moveA( -267.353,2285.82,76.3124)
    moveA( -282.145,2291.59,82.8552)
    moveA( -288.319,2297.7,88.9207)
    moveA( -288.182,2303.36,90.6058)
    castSpellB("寒冰护体(等级 6)")
    moveA( -293.301,2304.7,90.6088)
    castSpellB("魔爆术(等级 1)")
    moveA( -298.847,2294.08,93.8259)
    castSpellB("魔爆术(等级 1)")
    moveA( -301.26,2284.39,95.8666)
    castSpellB("魔爆术(等级 1)")
    moveA( -288.668,2279.19,95.8666)
    castSpellB("魔爆术(等级 1)")
    moveA( -275.191,2273.84,95.8666)
    castSpellB("魔爆术(等级 1)")
    moveA( -260.488,2268.23,99.3825)
    castSpellB("魔爆术(等级 1)")
    moveA( -250.717,2263.65,100.889)
    castSpellB("魔爆术(等级 1)")
    moveA( -230.543,2259.89,102.716)
    castSpellB("魔爆术(等级 1)")
    moveA( -251.658,2248.04,100.892)
    castSpellB("魔爆术(等级 1)")
    moveA( -254.032,2245.61,100.892)
    castSpellB("魔爆术(等级 1)")
    moveA( -252.253,2243.25,100.892)
    castSpellB("魔爆术(等级 1)")
    moveA( -249.742,2236.21,100.895)
    castSpellB("寒冰护体(等级 6)")
    moveA( -244.026,2229.56,96.9563)
    castSpellB("魔爆术(等级 1)")
    moveA( -233.452,2232.09,93.54)
    castSpellB("魔爆术(等级 1)")
    moveA( -231.973,2220.98,95.4906)
    castSpellB("魔爆术(等级 1)")
    moveA( -240.845,2186.5,95.9983)
    castSpellB("魔爆术(等级 1)")
    moveA( -245.687,2174.99,93.9355)
    castSpellB("魔爆术(等级 1)")
    moveA( -253.632,2162.67,93.9333)
    castSpellB("魔爆术(等级 1)")
    moveA( -246.66,2158.78,92.4584)
    castSpellB("魔爆术(等级 1)")
    moveA( -249.82,2151.49,91.106)
    castSpellB("魔爆术(等级 1)")
    moveA( -256.175,2153.47,91.1044)
    castSpellB("魔爆术(等级 1)")
    moveA( -259.601,2146.78,92.8354)
    castSpellB("魔爆术(等级 1)")
    moveA( -267.682,2150.65,95.8012)
    castSpellB("魔爆术(等级 1)")
    moveA( -269.32,2142.78,96.008)
    castSpellB("魔爆术(等级 1)")
    moveA( -254.702,2137.77,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -246.144,2141.51,100.029)
    castSpellB("寒冰护体(等级 6)")
    moveA( -239.356,2144.18,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -245.269,2128.91,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -249.097,2121.12,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -257.202,2122.8,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -259.119,2115.79,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -245.955,2110.14,100.029)
    castSpellB("魔爆术(等级 1)")
    moveA( -232.359,2105.11,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -217.923,2099.84,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -209.683,2097.13,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -202.857,2105.31,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -199.567,2112.77,97.3902)
    castSpellB("急速冷却")
    moveA( -198.063,2116.38,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -195.635,2122.6,97.3902)
    castSpellB("寒冰护体(等级 6)")
    moveA( -195.635,2122.6,97.3902)
    castSpellB("寒冰护体(等级 6)")
    moveA( -195.635,2122.6,97.3902)
    castSpellB("寒冰护体(等级 6)")
    moveA( -193.264,2129.73,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -191.734,2137.17,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -188.383,2151.24,97.3902)
    castSpellB("魔爆术(等级 1)")
    moveA( -185.054,2161.41,97.3902)
    castSpellB("魔爆术(等级 8)")
    sleep(1400)
    moveA( -185.054,2161.41,97.3902)
    battle()
    sleep(2400)
    moveA(-185.054,2161.41,97.3902)
    castSpellB("解除次级诅咒")
    pickUp()
    sleep(1400)
    drink()
    sleep(69000)
    --准备继续深入
    moveA( -185.203,2160.95,97.3901)
    castSpellB("寒冰护体(等级 6)")
    moveA( -182.878,2167.37,97.3901)
    castSpellB("魔爆术(等级 1)")
    moveA( -181.139,2180.59,98.0571)
    castSpellB("魔爆术(等级 1)")
    moveA( -172.413,2183.82,95.9223)
    castSpellB("魔爆术(等级 1)")
    moveA( -172.441,2173.32,94.0567)
    castSpellB("魔爆术(等级 1)")
    moveA( -161.926,2169.4,94.0424)
    castSpellB("魔爆术(等级 1)")
    moveA( -149.817,2165.12,94.0424)
    castSpellB("魔爆术(等级 1)")
    moveA( -136.546,2161.16,94.0424)
    castSpellB("魔爆术(等级 1)")
    moveA( -132.208,2170.08,94.0436)
    castSpellB("魔爆术(等级 1)")
    moveA( -141.794,2172.98,97.6927)
    castSpellB("魔爆术(等级 1)")
    moveA( -150.641,2174.99,99.8763)
    castSpellB("魔爆术(等级 1)")
    moveA( -158.561,2176.93,102.192)
    castSpellB("魔爆术(等级 1)")
    moveA( -154.113,2187.1,104.943)
    castSpellB("魔爆术(等级 1)")
    moveA( -148.152,2185.53,107.007)
    castSpellB("魔爆术(等级 1)")
    moveA( -134.966,2180.27,112.695)
    castSpellB("魔爆术(等级 1)")
    moveA( -126.49,2177.93,112.695)
    castSpellB("魔爆术(等级 1)")
    moveA( -118.688,2173.8,111.906)
    castSpellB("魔爆术(等级 1)")
    moveA( -103.56,2167.88,104.995)
    castSpellB("魔爆术(等级 1)")
    moveA( -106.086,2160.62,102.869)
    castSpellB("魔爆术(等级 1)")
    moveA( -111.105,2152.95,101.52)
    castSpellB("魔爆术(等级 1)")
    moveA( -121.542,2156.15,101.52)
    castSpellB("魔爆术(等级 1)")
    moveA( -133.734,2159.56,103.595)
    castSpellB("魔爆术(等级 1)")
    moveA( -146.408,2164.17,107.541)
    castSpellB("魔爆术(等级 1)")
    moveA( -159.753,2169.48,109.195)
    castSpellB("魔爆术(等级 1)")
    moveA( -173.629,2175.42,109.255)
    castSpellB("魔爆术(等级 1)")
    moveA( -173.282,2183.64,110.598)
    castSpellB("魔爆术(等级 1)")
    moveA( -181.074,2189.76,113.464)
    castSpellB("魔爆术(等级 1)")
    moveA( -184.947,2178.99,116.366)
    castSpellB("魔爆术(等级 1)")
    moveA( -174.576,2176.71,118.902)
    castSpellB("魔爆术(等级 1)")
    moveA( -175.327,2188.94,122.116)
    castSpellB("魔爆术(等级 1)")
    moveA( -185.596,2186.96,124.549)
    castSpellB("寒冰护体(等级 6)")
    moveA( -183.852,2178.42,126.52)
    castSpellB("魔爆术(等级 1)")
    moveA( -173.333,2177.11,129.087)
    castSpellB("魔爆术(等级 1)")
    moveA( -169.971,2182.9,129.255)
    castSpellB("魔爆术(等级 1)")
    moveA( -156.696,2176.78,128.696)
    castSpellB("魔爆术(等级 1)")
    moveA( -143.734,2171.9,127.953)
    castSpellB("魔爆术(等级 1)")
    moveA( -145.712,2172.45,127.953)
    battle()
    sleep(1400)
    castSpellB("解除次级诅咒")
    sleep(1400)
    pickUp()
    drink()
    --副本结束



    unusedBag = getUnusedAllBagSlotNum()--获得背包剩余的格子数目
    headDuration = getEquipementDurationBySlotNum(1)
    if unusedBag >= 10 and headDuration >= 10 then --如果装备不红，背包没满，就出本继续
        
        moveA(-146.44,2173.7,127.953)
        moveA(-155.118,2176.78,128.676)
        moveA(-166.498,2180.88,129.257)
        moveA(-172.074,2181.14,129.256)
        moveA(-173.142,2180.28,129.256)
        moveA(-183.015,2177.12,126.9)
        moveA(-183.595,2186.94,124.317)
        moveA(-173.545,2187.04,121.461)
        moveA(-172.895,2177.45,119.282)
        moveA(-184.453,2177.46,116.619)
        moveA(-186.706,2185.51,114.899)
        moveA(-186.12,2187.06,114.631)
        moveA(-177.707,2191.18,112.726)
        moveA(-176.557,2191.01,112.482)
        sleep(39000)
        moveA(-171.553,2182.28,110.257)
        moveA(-173.934,2175.16,109.255)
        moveA(-162.712,2170.63,109.216)
        moveA(-148.585,2165.27,108.253)
        moveA(-138.362,2161.32,105.041)
        moveA(-125.004,2156.08,101.515)
        moveA(-122.921,2161.19,101.518)
        moveA(-133.137,2163.98,94.0418)
        moveA(-139.455,2160.79,94.0418)
        moveA(-156.079,2167.3,94.0418)
        moveA(-168.582,2171.58,94.0418)
        moveA(-172.925,2174.78,94.0563)
        moveA(-172.736,2182.69,95.8248)
        moveA(-179.612,2183.05,97.5123)
        moveA(-182.17,2177.72,97.8291)
        moveA(-182.795,2167.13,97.3899)
        moveA(-188.061,2151.09,97.3899)
        moveA(-193.776,2134.39,97.3899)
        moveA(-199.74,2117.39,97.3899)
        moveA(-204.864,2119.5,97.3899)
        moveA(-204.864,2119.5,97.3899)
        jumpA(-207.06,2120.46,98.8348)
        moveA(-207.06,2120.46,98.8348)
        moveA(-212.14,2121.94,100.469)
        moveA(-216.551,2122.99,96.2948)
        moveA(-227.343,2124.63,80.3364)
        moveA(-229.484,2109.7,76.8899)
        useLua("/party follow2")
        moveB(-230.714,2106.73,76.8906)
        waitForLoading()
        useLua("/run ResetInstances()") --重置
        --结束等待读条10s

    elseif unusedBag < 10 or headDuration <= 10 then --回城修理
        if unusedBag ~= -1 and headDuration ~= -1 then
            sleep(2000)
            useItem("炉石")
            waitForLoading()
            moveA(507.828,1633.19,125.944)
            moveA(507.777,1627.18,125.668)
            mail()
            moveA(508.91,1607.54,125.284)
            moveA(511.54,1601.04,126.188)
            moveA(532.874,1595.78,127.735)
            moveA(543.413,1590.69,129.358)
            moveA(562.871,1559.44,132.722)
            ID1,ID2 = getClosetTargetIDFilterName("纳迪亚・沃农",3,8)
            contactTarget(ID1,ID2)
            sleep(1000) --等待打开修理界面
            useLua("/run RepairAllItems()")
            sleep(3000)
            useLua("/click MerchantFrameCloseButton")
            useItem("霜狼嗥叫者的号角")
            sleep(3500)
            moveA(524.207,1550.02,132.172)
            moveA(474.661,1531.74,131.921)
            moveA(416.947,1501.79,131.991)
            moveA(331.566,1444.23,126.09)
            moveA(278.672,1415.49,114.477)
            moveA(229.956,1407.6,108.425)
            moveA(212.282,1401.68,104.886)
            moveA(176.519,1382.34,97.6568)
            moveA(141.872,1362.77,93.2817)
            moveA(113.272,1360.48,97.7161)
            moveA(79.3817,1350.09,71.8917)
            moveA(69.9436,1344.97,68.655)
            moveA(40.5155,1344.08,63.4836)
            moveA(0.419997,1333.94,60.4051)
            moveA(-56.8804,1334.13,62.7332)
            moveA(-119.799,1315.45,55.6782)
            moveA(-154.218,1317.86,46.9533)
            moveA(-229.538,1379.33,35.5958)
            moveA(-273.986,1424.16,33.7821)
            moveA(-294.179,1462.44,36.2028)
            moveA(-278.519,1472.19,41.5892)
            useLua("/party follow2") --让小号出本
            moveA(-221.436,1455.96,61.3558)
            moveA(-200.925,1476.48,66.4843)
            moveA(-220.971,1505.42,72.6117)
            moveA(-247.69,1527.49,77.1437)
            moveA(-237.188,1556.68,76.8923)
            useLua("/run ResetInstances()") --重置
        end
    end


else --如果身上有灵魂状态的debuff
    moveA(-383.85,1118.02,84.4178)
    moveA(-376.517,1135.62,81.1283)
    moveA(-368.171,1175.55,66.7418)
    moveA(-369.341,1184.9,65.6991)
    moveA(-367.878,1203.66,64.619)
    moveA(-363.474,1233.56,52.7367)
    moveA(-355.099,1277.79,40.5408)
    moveA(-347.396,1327.28,33.7943)
    moveA(-338.379,1376.68,30.6281)
    moveA(-316.917,1421.04,31.1125)
    moveA(-295.262,1458.37,35.5607)
    moveA(-284.065,1471.49,39.5826)
    moveA(-252.795,1460.98,50.3686)
    moveA(-225.07,1455.52,60.3422)
    moveA(-201.992,1473.64,66.0579)
    moveA(-207.747,1496.39,70.4835)
    moveA(-233.094,1515.08,74.8345)
    moveA(-248.621,1527.58,77.1667)
    moveA(-240.966,1548.48,76.8923)
    moveB(-231.412,1570.74,76.8921)
    waitForLoading()
    moveB(-230.714,2106.73,76.8906)
    waitForLoading()

end